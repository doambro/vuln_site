-- 创建渗透测试靶场数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS `pentest_lab` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 使用渗透测试靶场数据库
USE `pentest_lab`;

-- 删除现有表（如果存在）
DROP TABLE IF EXISTS `users`;
DROP TABLE IF EXISTS `messages`;
DROP TABLE IF EXISTS `resources`;

-- 创建用户表
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `email` varchar(100) DEFAULT NULL,
  `avatar` varchar(255) DEFAULT 'default.jpg',
  `bio` text DEFAULT NULL,
  `is_admin` tinyint(1) DEFAULT 0,
  `status` tinyint(1) DEFAULT 1 COMMENT '0-禁用 1-正常',
  `deleted_at` timestamp NULL DEFAULT NULL COMMENT '删除时间',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `last_login` timestamp NULL DEFAULT NULL,
  `login_ip` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 创建留言表
CREATE TABLE `messages` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `username` varchar(50) NOT NULL,
  `message` text NOT NULL,
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 创建资源表
CREATE TABLE `resources` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `url` varchar(255) NOT NULL,
  `description` text,
  `category` varchar(100) DEFAULT '未分类', -- 新增分类字段
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 插入测试用户数据
INSERT INTO `users` (`username`, `password`, `email`, `bio`, `is_admin`) VALUES
('admin', 'admin123', 'admin@example.com', '网站管理员，负责维护渗透测试靶场', 1),
('test', 'test123', 'test@example.com', '测试账号，用于演示常见漏洞', 0),
('john', 'password', 'john@example.com', '安全爱好者，经常在这里练习渗透技能', 0);

-- 插入测试留言数据
INSERT INTO `messages` (`user_id`, `username`, `message`, `create_time`) VALUES
(1, 'admin', '欢迎来到渗透测试靶场！这里可以练习各种安全测试技能。', '2025-04-15 10:00:00'),
(2, 'test', '这个留言板有XSS漏洞，可以尝试插入一些脚本标签。', '2025-04-15 11:30:00'),
(3, 'john', '登录页面存在SQL注入漏洞，可以绕过身份验证。', '2025-04-16 09:15:00'),
(2, 'test', '<script>alert("XSS测试");</script>', '2025-04-16 14:20:00');

-- 提醒：这是一个故意包含安全漏洞的数据库结构，仅供学习和测试使用
